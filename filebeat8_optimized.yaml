filebeat.config:
  modules:
    path: ${path.config}/modules.d/*.yml
    reload.enabled: false

filebeat.inputs:
- type: container
  enabled: true
  paths:
  - /var/log/containers/*.log
  exclude_lines:
  - '"index_type__":'
  processors:
  - add_kubernetes_metadata:
      in_cluster: true
  - drop_event:
      when:
        equals:
          kubernetes.container.name: fedlearner-filebeat
  - include_fields:
      fields:
      - index_type__
      - name
      - value
      - tags

http.enabled: true
http.port: 5066

output.elasticsearch:
  hosts:
  - http://elasticsearch.elk.svc.cluster.local:9200
  indices:
  - index: data_join
    when.equals:
      index_type__: data_join
  - index: raw_data
    when.equals:
      index_type__: raw_data
  - index: metrics_v2
    when.equals:
      index_type__: metrics
  - index: "filebeat_fedlearner_nonprod-%{+yyyy.MM.dd}"

processors:
- drop_fields:
    fields:
    - agent.ephemeral_id
    - agent.hostname
    - agent.id
    - agent.type
    - agent.version
    - ecs.version
    - agent
    - ecs
- include_fields:
    fields:
    - host.name
    - input.type
    - kubernetes.container.name
    - kubernetes.namespace
    - kubernetes.node.name
    - kubernetes.pod.name
    - kubernetes.pod.uid
    - log.file.path
    - log.offset
    - message
    - stream
    when.not:
      has_fields:
      - index_type__
